"use strict";var map,restaurant=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){if(e)console.error(e);else{self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1});var n=document.getElementById("map");self.map.addListener("tilesloaded",function(){n.querySelectorAll("img").forEach(function(e){return e.alt="Google Maps Image"})}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)}})};var fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),n(null,t)):console.error(e)}):(error="No restaurant id in URL",n(error,null))}},fetchReviewsFromURL=function(e){if(self.reviews)e(null,self.reviews);else{var t=getParameterByName("id");t?DBHelper.fetchReviewsByRestaurantId(t,function(e,t){(self.reviews=t)?fillReviewsHTML():fillReviewsHTML(null)}):(error="No review id in URL",e(error,null))}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name;var n=document.createElement("span");n.className="restaurant-fav";var r=document.createElement("img");"true"===e.is_favorite?(r.alt="Favorited "+e.name,r.setAttribute("data-src","./dist/img/ico-fav.png"),r.className="restaurant-fav-icon fav"):(r.setAttribute("data-src","./dist/img/ico-fav-o.png"),r.className="restaurant-fav-icon fav-not"),r.addEventListener("click",function(){r.src.includes("dist/img/ico-fav-o.png")?DBHelper.addRestaurantToFavorites(e.id,!0,function(e,t){r.src="./dist/img/ico-fav.png"}):DBHelper.addRestaurantToFavorites(e.id,!1,function(e,t){r.src="./dist/img/ico-fav-o.png"})}),n.append(r),t.prepend(n);var a=document.getElementById("restaurant-address");a.innerHTML=e.address,a.setAttribute("role","address");var i=document.getElementById("restaurant-img");i.className="restaurant-img",i.setAttribute("data-src",DBHelper.imageUrlForRestaurant(e)),i.alt=e.name+" Restaurant Image",document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,new LazyLoad,e.operating_hours&&fillRestaurantHoursHTML(),fetchReviewsFromURL()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,a.tabIndex=0,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],i.tabIndex=0,r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.reviews,t=document.getElementById("reviews-container");if(!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}var r=document.getElementById("reviews-list");e.forEach(function(e){r.appendChild(createReviewHTML(e))}),t.appendChild(r)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("div");n.setAttribute("class","reviews-list-header"),t.appendChild(n);var r=document.createElement("p");r.innerHTML=e.name,n.appendChild(r);var a=document.createElement("p");a.innerHTML=moment(e.createdAt).format("ddd, MMM Do YYYY"),n.appendChild(a);var i=document.createElement("p");i.innerHTML="Rating: "+e.rating,i.setAttribute("class","rating"),t.appendChild(i);var l=document.createElement("p");return l.innerHTML=e.comments,t.appendChild(l),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,n.setAttribute("class","rating"),t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},reviewRestaurant=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant).id,t=document.getElementById("review-name").value,n=document.getElementById("review-rating").value,r=document.getElementById("review-comment").value;if(""!=t&&""!=r){var a={restaurant_id:e,name:t,rating:n,comments:r};fetch(DBHelper.DATABASE_URL+"/reviews",{method:"post",body:JSON.stringify(a)}).then(function(e){return e.json()}).catch(function(e){console.log("Something went wrong submitting your review")}),window.location.reload()}return!1};