"use strict";var map,restaurant=void 0;window.addEventListener("DOMContentLoaded",function(e){navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(function(e){return console.log("Registeration Worked With Scope: "+e.scope)}).catch(function(e){return console.error("ERROR_REGISTERING_SW: "+e)}),navigator.onLine||DBHelper.fetchRestaurantById(DBHelper.getParameterByName("id")).then(function(e){return initMap(e)})}),window.addEventListener("load",function(e){connectionStatusHandler=function(e){var t=document.getElementById("offline-status-box");navigator.onLine?(t.style.display="none",document.getElementById("offline-status").innerHTML="Online :)",DBHelper.postCachedReviews()):(t.style.display="block",document.getElementById("offline-status").innerHTML="you are offline!! Some data might not be latest.")},window.addEventListener("online",connectionStatusHandler),window.addEventListener("offline",connectionStatusHandler)}),initMap=function(e){self.restaurant=e,navigator.onLine&&(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:self.restaurant.latlng,scrollwheel:!1}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)),fillBreadcrumb(),fillRestaurantHTML()},window.renderPage=function(){self.restaurant||DBHelper.fetchRestaurantById(DBHelper.getParameterByName("id")).then(function(e){return initMap(e)})},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name;var n=document.createElement("span");n.className="restaurant-fav";var r=document.createElement("img");"true"===e.is_favorite?(r.alt="Restaurant Favorited "+e.name,r.setAttribute("data-src","./dist/img/ico-fav.png"),r.className="restaurant-fav-icon fav"):(r.setAttribute("data-src","./dist/img/ico-fav-o.png"),r.className="restaurant-fav-icon fav-not"),r.addEventListener("click",function(){r.src.includes("dist/img/ico-fav-o.png")?DBHelper.addRestaurantToFavorites(e.id,!0,function(e,t){r.src="./dist/img/ico-fav.png"}):DBHelper.addRestaurantToFavorites(e.id,!1,function(e,t){r.src="./dist/img/ico-fav-o.png"})}),n.append(r),t.prepend(n),document.getElementById("restaurant-address").innerHTML=e.address;var a=document.getElementById("restaurant-img");a.className="restaurant-img",a.alt=e.name+" - "+e.cuisine_type+" cuisine in the "+e.neighborhood+" Neighbourhood",a.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviewsByRestaurantId(self.restaurant.id).then(function(e){return setReviews(e)})},setReviews=function(e){self.restaurant.reviews=e,fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container");if(!e){var n=document.createElement("p");return n.innerHTML="No reviews yet!",void t.appendChild(n)}var r=document.getElementById("reviews-list");e.forEach(function(e){r.appendChild(createReviewHTML(e))}),t.appendChild(r)},addReviewHTML=function(e){1<arguments.length&&void 0!==arguments[1]?arguments[1]:self.restaurant.reviews;var t=document.getElementById("reviews-container"),n=document.getElementById("reviews-list");n.prepend(createReviewHTML(e)),t.append(n)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("div");n.setAttribute("class","reviews-list-header"),t.appendChild(n);var r=document.createElement("p");r.innerHTML=e.name,n.appendChild(r);var a=document.createElement("p");a.innerHTML=moment(e.createdAt).format("ddd, MMM Do YYYY"),n.appendChild(a);var i=document.createElement("p");i.innerHTML="Rating: "+e.rating,i.setAttribute("class","rating"),t.appendChild(i);var o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},reviewFormHandler=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t={name:document.getElementById("username").value,rating:parseInt(document.getElementById("rating").value),comments:document.getElementById("comment").value,createdAt:+new Date,updatedAt:+new Date,restaurant_id:e.id};addReviewHTML(t),navigator.onLine?DBHelper.postReview(t).then(function(e){e?(document.getElementById("form-legend").innerHTML="Your Review Has Been Saved, Thank You For Sharing Your Thoughts.",document.getElementById("reviews-form").reset()):document.getElementById("form-legend").innerHTML="An Unexpected Error Occured, Please Try Again Later."}).catch(function(e){return console.error("ERROR_SAVING_REVIEW: "+e)}):DBHelper.cacheObject(t,DBHelper.REVIEWS_OFFLINE_IDB_NAME,DBHelper.REVIEWS_OFFLINE_STORE_NAME)};